module src/lib/runner/runInterpreter

import src/lib/interpreter/eval
import src/lib/desugar/coreAst
import src/lib/utils/errors
import src/lib/runner/result
import src/lib/utils/handlers
import src/lib/utils/effects

/// runs the interpreter on a desugared program, returning either a Failure with an error message or a Success with the resulting value
def runEval(prog: Program): PipelineResult[Value]  = {
  var currentPos = Position(1, 1)
  try {
    with mockInspector[PipelineResult[Value], Address]
    val result = evalProgram(prog)
    PipelineResult::Success(result)
  } with Exception[RuntimeError] {
    def raise(exception, msg) = Failure("RuntimeError: " ++ msg)
  } with Positioning {
    def getPos() = resume(currentPos)
    def setPos(p) = {
      currentPos = p
      resume(())
    }
  }
}